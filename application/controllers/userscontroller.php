<?php class UsersController extends Controller {			public function homepage()	{			$header = "Homepage";		$this->set('header', $header);	}	public function logout()	{		if ( isset($_SESSION['userrole'])) {			session_destroy();			header("location:../guests/homepage");		}	}	public function bestel($id=0)	{		$optreden = $this->_model->select_optreden_by_id($id);		$title = "<h2>".$optreden[0]['Optreden']['naam']."</h2>";		$prijs = $optreden[0]['Optreden']['kaart_prijs'];		$header = "<h1>reservering</h1>";		$this->set('header',$header);		$this->set('title',$title);		$this->set('prijs',"&#8364; ".$prijs);		$this->set('id',$id);		if (isset($_POST['amount'])) {			if ($this->check_login()){				$amount = $_POST['amount'];				$user = $this->_model->select_user_by_id($_SESSION['user_id']);				if($this->check_korting_over()){					$this->_model->set_korting($_SESSION['user_id'],1); // 0 = true , 1 = false					$this->_model->set_totaal($user[0]['User']['totaal_deze_periode'],0);				}				if ($this->check_korting()){					$korting = ($amount * $prijs)/100*25;					$prijs_totaal = ($amount * $prijs)-$korting;					// echo $prijs_totaal; exit();				}				else{					$prijs_totaal = $amount * $prijs;				}				$prijs_old = $user[0]['User']['totaal_deze_periode'];				$this->_model->add_bestelling($_POST,$prijs_totaal,$prijs_old);				$user = $this->_model->select_user_by_id($_SESSION['user_id']);				if($user[0]['User']['totaal_deze_periode'] > 500 &&	 $user[0]['User']['heeft_korting'] == 1){					$this->_model->set_korting($_SESSION['user_id'],0); // 0 = true , 1 = false				}				header("refresh:0;url=".BASE_URL."users/bestel/".$id."");			}			else			{				$header = "<h1>U bent niet ingelogd,<br> u wordt doorgestuurd naar de login pagina</h1>";				header("refresh:4;url=".BASE_URL."guests/login");			}		}		$this->set('header',$header);	}	public function check_korting_over(){		date_default_timezone_set("Europe/Amsterdam");		$date = Date("Y-m-d H:i:s");		$user = $this->_model->select_user_by_id($_SESSION['user_id']);		$date = new DateTime(Date("Y-m-d H:i:s"));		$eind_datum = new DateTime($user[0]['User']['korting_sinds']);		$eind_datum->add(new DateInterval('P31D'));		$interval = $date->diff($eind_datum);		$interval_indays = $interval->format('%R%a days')+1;		// echo $interval_indays." 31";		// echo $user[0]['User']['heeft_korting']." 0";		if($interval_indays <31 && $user[0]['User']['heeft_korting'] == 0){			$korting_over = true;			// echo "true"; exit();		}		else{			$korting_over = false;			// echo "false"; exit();		}		return $korting_over;	}	public function check_korting()	{		$user = $this->_model->select_user_by_id($_SESSION['user_id']);				return $user[0]['User']['heeft_korting'] == 0;	}	public function check_login()	{		if (isset($_SESSION['user_id']))		{			return true;		}		else		{			return false;		}	}}?>